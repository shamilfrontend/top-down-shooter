var x=Object.defineProperty;var k=(r,t,e)=>t in r?x(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var o=(r,t,e)=>k(r,typeof t!="symbol"?t+"":t,e);import{m}from"./index-BjcpxiQA.js";const d="/api",g=m([]),S=new Map;function P(){async function r(){const e=await fetch(`${d}/maps`);if(!e.ok)throw new Error("Ошибка загрузки списка карт");return g.value=await e.json(),g.value}async function t(e){const s=S.get(e);if(s)return s;const h=await fetch(`${d}/maps/${e}`);if(!h.ok)throw new Error("Карта не найдена");const c=await h.json();return S.set(e,c),c}return{mapsList:g,fetchMapsList:r,fetchMap:t}}const p={crate:30,barrel:20};class R{constructor(t,e,s,h){o(this,"ctx");o(this,"map");o(this,"scale",1);o(this,"offsetX",0);o(this,"offsetY",0);o(this,"canvasWidth");o(this,"canvasHeight");this.ctx=t,this.map=e,this.canvasWidth=s,this.canvasHeight=h}setSize(t,e){this.canvasWidth=t,this.canvasHeight=e}setCamera(t,e,s=1){this.offsetX=this.canvasWidth/2-t*s,this.offsetY=this.canvasHeight/2-e*s,this.scale=s}worldToScreen(t,e){return[t*this.scale+this.offsetX,e*this.scale+this.offsetY]}screenToWorld(t,e){return[(t-this.offsetX)/this.scale,(e-this.offsetY)/this.scale]}applyWorldTransform(t){t.translate(this.offsetX,this.offsetY),t.scale(this.scale,this.scale)}render(){const{ctx:t,map:e,scale:s,offsetX:h,offsetY:c}=this;t.save(),t.fillStyle="#181820",t.fillRect(0,0,this.canvasWidth,this.canvasHeight),t.translate(h,c),t.scale(s,s),t.fillStyle="#2e2e3e",t.fillRect(0,0,e.width,e.height),t.strokeStyle="rgba(255,255,255,0.03)",t.lineWidth=1/s;const n=100;for(let i=0;i<=e.width;i+=n)t.beginPath(),t.moveTo(i,0),t.lineTo(i,e.height),t.stroke();for(let i=0;i<=e.height;i+=n)t.beginPath(),t.moveTo(0,i),t.lineTo(e.width,i),t.stroke();e.walls.forEach(i=>{t.fillStyle="#4a4a6a",t.fillRect(i.x,i.y,i.width,i.height),t.fillStyle="rgba(255,255,255,0.08)",t.fillRect(i.x,i.y,i.width,3/s),t.fillRect(i.x,i.y,3/s,i.height),t.fillStyle="rgba(0,0,0,0.3)",t.fillRect(i.x,i.y+i.height-3/s,i.width,3/s),t.fillRect(i.x+i.width-3/s,i.y,3/s,i.height),t.strokeStyle="rgba(0,0,0,0.4)",t.lineWidth=1/s,t.strokeRect(i.x,i.y,i.width,i.height)}),e.obstacles.forEach(i=>{const a=p[i.type]??25;if(i.type==="crate")t.fillStyle="#8B6914",t.fillRect(i.x,i.y,a,a),t.strokeStyle="#6B4F12",t.lineWidth=2/s,t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(i.x+a,i.y+a),t.moveTo(i.x+a,i.y),t.lineTo(i.x,i.y+a),t.stroke(),t.strokeStyle="#4a3510",t.lineWidth=1/s,t.strokeRect(i.x,i.y,a,a);else if(i.type==="barrel"){const l=i.x+a/2,f=i.y+a/2,y=a/2;t.fillStyle="#5a5a5a",t.beginPath(),t.arc(l,f,y,0,Math.PI*2),t.fill(),t.strokeStyle="#888",t.lineWidth=2/s,t.beginPath(),t.arc(l,f,y*.7,0,Math.PI*2),t.stroke(),t.strokeStyle="#333",t.lineWidth=1/s,t.beginPath(),t.arc(l,f,y,0,Math.PI*2),t.stroke()}}),t.fillStyle="rgba(80, 140, 220, 0.15)",t.strokeStyle="rgba(80, 140, 220, 0.3)",t.lineWidth=1/s,e.spawnPoints.ct.forEach(i=>{t.beginPath(),t.arc(i.x+15,i.y+15,22,0,Math.PI*2),t.fill(),t.stroke()}),t.fillStyle="rgba(220, 80, 80, 0.15)",t.strokeStyle="rgba(220, 80, 80, 0.3)",e.spawnPoints.t.forEach(i=>{t.beginPath(),t.arc(i.x+15,i.y+15,22,0,Math.PI*2),t.fill(),t.stroke()}),t.restore()}renderPickups(t){const{ctx:e,scale:s,offsetX:h,offsetY:c}=this,n=Date.now()/1e3;e.save(),e.translate(h,c),e.scale(s,s),t.forEach(i=>{const a=Math.sin(n*3+i.x*.1)*2,l=.4+Math.sin(n*2)*.15;i.type==="ammo"?(e.save(),e.translate(i.x,i.y+a),e.shadowColor="rgba(200, 160, 40, 0.6)",e.shadowBlur=8,e.fillStyle=`rgba(200, 160, 40, ${l+.3})`,e.fillRect(-10,-7,20,14),e.strokeStyle="#a08020",e.lineWidth=1/s,e.strokeRect(-10,-7,20,14),e.fillStyle="#fff",e.font=`bold ${8/s<8,8}px monospace`,e.textAlign="center",e.textBaseline="middle",e.fillText("A",0,0),e.restore()):i.type==="medkit"&&(e.save(),e.translate(i.x,i.y+a),e.shadowColor="rgba(46, 204, 113, 0.6)",e.shadowBlur=8,e.fillStyle=`rgba(240, 240, 240, ${l+.3})`,e.fillRect(-10,-10,20,20),e.strokeStyle="#2ecc71",e.lineWidth=1.5/s,e.strokeRect(-10,-10,20,20),e.fillStyle="#e74c3c",e.fillRect(-2,-7,4,14),e.fillRect(-7,-2,14,4),e.restore())}),e.restore()}}export{R as M,P as u};

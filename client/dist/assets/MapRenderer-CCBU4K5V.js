var T=Object.defineProperty;var v=(x,t,e)=>t in x?T(x,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):x[t]=e;var S=(x,t,e)=>v(x,typeof t!="symbol"?t+"":t,e);import{p as u}from"./index-AYzDde7z.js";const P="/api",m=u([]),k=new Map;function C(){async function x(){const e=await fetch(`${P}/maps`);if(!e.ok)throw new Error("Ошибка загрузки списка карт");return m.value=await e.json(),m.value}async function t(e){const f=k.get(e);if(f)return f;const s=await fetch(`${P}/maps/${e}`);if(!s.ok)throw new Error("Карта не найдена");const h=await s.json();return k.set(e,h),h}return{mapsList:m,fetchMapsList:x,fetchMap:t}}const M={crate:30,barrel:20};class p{constructor(t,e,f,s){S(this,"ctx");S(this,"map");S(this,"scale",1);S(this,"offsetX",0);S(this,"offsetY",0);S(this,"canvasWidth");S(this,"canvasHeight");S(this,"floorPattern",null);S(this,"wallPattern",null);this.ctx=t,this.map=e,this.canvasWidth=f,this.canvasHeight=s,this.buildPatterns()}buildPatterns(){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e.fillStyle="#3a3a48",e.fillRect(0,0,64,64);for(let h=0;h<120;h++){const R=Math.random()*64,l=Math.random()*64,o=40+Math.floor(Math.random()*30);e.fillStyle=`rgba(${o},${o},${o+8},0.25)`,e.fillRect(R,l,1+Math.random()*2,1+Math.random()*2)}e.strokeStyle="rgba(0,0,0,0.12)",e.lineWidth=.5;for(let h=0;h<3;h++)e.beginPath(),e.moveTo(Math.random()*64,Math.random()*64),e.lineTo(Math.random()*64,Math.random()*64),e.stroke();e.strokeStyle="rgba(255,255,255,0.04)",e.lineWidth=1,e.strokeRect(0,0,64,64),this.floorPattern=this.ctx.createPattern(t,"repeat");const f=document.createElement("canvas");f.width=32,f.height=20;const s=f.getContext("2d");s.fillStyle="#5a5a72",s.fillRect(0,0,32,20),s.fillStyle="rgba(0,0,0,0.25)",s.fillRect(0,9,32,2),s.fillRect(15,0,2,10),s.fillRect(0,10,2,10),s.fillRect(31,10,1,10);for(let h=0;h<30;h++){const R=Math.random()*32,l=Math.random()*20;s.fillStyle=`rgba(${60+Math.floor(Math.random()*40)},${60+Math.floor(Math.random()*30)},${80+Math.floor(Math.random()*30)},0.15)`,s.fillRect(R,l,1+Math.random(),1+Math.random())}this.wallPattern=this.ctx.createPattern(f,"repeat")}setSize(t,e){this.canvasWidth=t,this.canvasHeight=e}setCamera(t,e,f=1){this.offsetX=this.canvasWidth/2-t*f,this.offsetY=this.canvasHeight/2-e*f,this.scale=f}worldToScreen(t,e){return[t*this.scale+this.offsetX,e*this.scale+this.offsetY]}screenToWorld(t,e){return[(t-this.offsetX)/this.scale,(e-this.offsetY)/this.scale]}applyWorldTransform(t){t.translate(this.offsetX,this.offsetY),t.scale(this.scale,this.scale)}render(){const{ctx:t,map:e,scale:f,offsetX:s,offsetY:h}=this;t.save(),t.fillStyle="#10101a",t.fillRect(0,0,this.canvasWidth,this.canvasHeight),t.translate(s,h),t.scale(f,f),this.floorPattern?(t.fillStyle=this.floorPattern,t.fillRect(0,0,e.width,e.height)):(t.fillStyle="#3a3a48",t.fillRect(0,0,e.width,e.height)),t.strokeStyle="rgba(255,255,255,0.035)",t.lineWidth=1;const R=200;for(let l=0;l<=e.width;l+=R)t.beginPath(),t.moveTo(l,0),t.lineTo(l,e.height),t.stroke();for(let l=0;l<=e.height;l+=R)t.beginPath(),t.moveTo(0,l),t.lineTo(e.width,l),t.stroke();e.walls.forEach(l=>{t.fillStyle="rgba(0,0,0,0.25)",t.fillRect(l.x+6,l.y+6,l.width,l.height)}),e.walls.forEach(l=>{this.wallPattern?t.fillStyle=this.wallPattern:t.fillStyle="#5a5a72",t.fillRect(l.x,l.y,l.width,l.height),t.fillStyle="rgba(255,255,255,0.1)",t.fillRect(l.x,l.y,l.width,4),t.fillRect(l.x,l.y,4,l.height),t.fillStyle="rgba(0,0,0,0.35)",t.fillRect(l.x,l.y+l.height-4,l.width,4),t.fillRect(l.x+l.width-4,l.y,4,l.height),t.strokeStyle="rgba(0,0,0,0.5)",t.lineWidth=1,t.strokeRect(l.x,l.y,l.width,l.height)}),e.obstacles.forEach(l=>{const o=M[l.type]??25;if(t.fillStyle="rgba(0,0,0,0.2)",l.type==="barrel"?(t.beginPath(),t.arc(l.x+o/2+3,l.y+o/2+3,o/2,0,Math.PI*2),t.fill()):t.fillRect(l.x+3,l.y+3,o,o),l.type==="crate"){t.fillStyle="#8B7530",t.fillRect(l.x,l.y,o,o),t.strokeStyle="#6B5520",t.lineWidth=1;for(let c=l.y+6;c<l.y+o;c+=7)t.beginPath(),t.moveTo(l.x,c),t.lineTo(l.x+o,c),t.stroke();t.strokeStyle="#5a4418",t.lineWidth=2,t.beginPath(),t.moveTo(l.x+2,l.y+2),t.lineTo(l.x+o-2,l.y+o-2),t.moveTo(l.x+o-2,l.y+2),t.lineTo(l.x+2,l.y+o-2),t.stroke(),t.fillStyle="#aaa";const r=4;t.fillRect(l.x+r-1,l.y+r-1,2,2),t.fillRect(l.x+o-r-1,l.y+r-1,2,2),t.fillRect(l.x+r-1,l.y+o-r-1,2,2),t.fillRect(l.x+o-r-1,l.y+o-r-1,2,2),t.strokeStyle="#3a2a10",t.lineWidth=1,t.strokeRect(l.x,l.y,o,o),t.fillStyle="rgba(255,255,255,0.08)",t.fillRect(l.x,l.y,o,2),t.fillRect(l.x,l.y,2,o),t.fillStyle="rgba(0,0,0,0.15)",t.fillRect(l.x,l.y+o-2,o,2),t.fillRect(l.x+o-2,l.y,2,o)}else if(l.type==="barrel"){const r=l.x+o/2,c=l.y+o/2,i=o/2,a=t.createRadialGradient(r-i*.3,c-i*.3,i*.1,r,c,i);a.addColorStop(0,"#6a6a6a"),a.addColorStop(1,"#3a3a3a"),t.fillStyle=a,t.beginPath(),t.arc(r,c,i,0,Math.PI*2),t.fill(),t.strokeStyle="#888",t.lineWidth=2,t.beginPath(),t.arc(r,c,i*.75,0,Math.PI*2),t.stroke(),t.strokeStyle="#777",t.lineWidth=1,t.beginPath(),t.arc(r,c,i*.45,0,Math.PI*2),t.stroke(),t.strokeStyle="#2a2a2a",t.lineWidth=1.5,t.beginPath(),t.arc(r,c,i,0,Math.PI*2),t.stroke()}}),e.spawnPoints.ct.forEach(l=>{t.fillStyle="rgba(60, 120, 200, 0.1)",t.strokeStyle="rgba(60, 120, 200, 0.2)",t.lineWidth=1,t.beginPath(),t.arc(l.x+15,l.y+15,22,0,Math.PI*2),t.fill(),t.stroke(),t.fillStyle="rgba(60, 120, 200, 0.15)",t.beginPath(),t.moveTo(l.x+15,l.y+5),t.lineTo(l.x+22,l.y+18),t.lineTo(l.x+8,l.y+18),t.closePath(),t.fill()}),e.spawnPoints.t.forEach(l=>{t.fillStyle="rgba(200, 70, 60, 0.1)",t.strokeStyle="rgba(200, 70, 60, 0.2)",t.lineWidth=1,t.beginPath(),t.arc(l.x+15,l.y+15,22,0,Math.PI*2),t.fill(),t.stroke(),t.fillStyle="rgba(200, 70, 60, 0.15)",t.beginPath(),t.moveTo(l.x+15,l.y+5),t.lineTo(l.x+22,l.y+18),t.lineTo(l.x+8,l.y+18),t.closePath(),t.fill()}),t.restore()}renderPickups(t){const{ctx:e,scale:f,offsetX:s,offsetY:h}=this,R=Date.now()/1e3;e.save(),e.translate(s,h),e.scale(f,f),t.forEach(l=>{const o=Math.sin(R*2.5+l.x*.1)*1.5;if(l.type==="ammo"){e.save(),e.translate(l.x,l.y+o),e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(-9,1,18,10);const r=20,c=13,i=-r/2,a=-c/2,g=e.createLinearGradient(i,a,i,a+c);g.addColorStop(0,"#4a5a30"),g.addColorStop(.5,"#3a4a22"),g.addColorStop(1,"#2c3818"),e.fillStyle=g,e.fillRect(i,a,r,c),e.fillStyle="rgba(255,255,255,0.1)",e.fillRect(i,a,r,2),e.fillRect(i,a,2,c),e.fillStyle="rgba(0,0,0,0.25)",e.fillRect(i,a+c-2,r,2),e.fillRect(i+r-2,a,2,c),e.fillStyle="#888",e.fillRect(-3,a,6,2.5),e.fillStyle="#666",e.fillRect(-2,a+.5,4,1.5),e.fillStyle="rgba(180,160,60,0.5)",e.fillRect(i+3,a+c*.35,r-6,2.5),e.fillStyle="#c8a840";for(let n=0;n<5;n++){const y=-7+n*3.5;e.fillRect(y,a+3,2,4),e.fillStyle="#a06030",e.fillRect(y,a+3,2,1.5),e.fillStyle="#c8a840"}e.strokeStyle="#1e2a10",e.lineWidth=1,e.strokeRect(i,a,r,c),e.restore()}else if(l.type==="medkit"){e.save(),e.translate(l.x,l.y+o),e.fillStyle="rgba(0,0,0,0.2)",e.beginPath(),e.ellipse(0,2,11,9,0,0,Math.PI*2),e.fill();const r=20,c=16,i=-r/2,a=-c/2,g=e.createLinearGradient(i,a,i,a+c);g.addColorStop(0,"#f0f0f0"),g.addColorStop(.4,"#e8e8e8"),g.addColorStop(1,"#d0d0d0"),e.fillStyle=g;const n=3;e.beginPath(),e.moveTo(i+n,a),e.lineTo(i+r-n,a),e.quadraticCurveTo(i+r,a,i+r,a+n),e.lineTo(i+r,a+c-n),e.quadraticCurveTo(i+r,a+c,i+r-n,a+c),e.lineTo(i+n,a+c),e.quadraticCurveTo(i,a+c,i,a+c-n),e.lineTo(i,a+n),e.quadraticCurveTo(i,a,i+n,a),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,0.3)",e.fillRect(i+n,a,r-n*2,2),e.fillStyle="rgba(0,0,0,0.1)",e.fillRect(i+n,a+c-2,r-n*2,2);const y=3.5,d=10;e.fillStyle="#cc2020",e.fillRect(-y/2,-d/2,y,d),e.fillRect(-d/2,-y/2,d,y),e.fillStyle="rgba(0,0,0,0.15)",e.fillRect(-y/2+.5,-d/2+.5,y-1,d-1),e.fillRect(-d/2+.5,-y/2+.5,d-1,y-1),e.strokeStyle="#991515",e.lineWidth=.5,e.strokeRect(-y/2,-d/2,y,d),e.strokeRect(-d/2,-y/2,d,y),e.strokeStyle="#999",e.lineWidth=1.5,e.beginPath(),e.arc(0,a-1,4,Math.PI,0),e.stroke(),e.fillStyle="#bbb",e.fillRect(i+2,-1,2,2),e.fillRect(i+r-4,-1,2,2),e.strokeStyle="#aaa",e.lineWidth=1,e.beginPath(),e.moveTo(i+n,a),e.lineTo(i+r-n,a),e.quadraticCurveTo(i+r,a,i+r,a+n),e.lineTo(i+r,a+c-n),e.quadraticCurveTo(i+r,a+c,i+r-n,a+c),e.lineTo(i+n,a+c),e.quadraticCurveTo(i,a+c,i,a+c-n),e.lineTo(i,a+n),e.quadraticCurveTo(i,a,i+n,a),e.closePath(),e.stroke(),e.restore()}}),e.restore()}}export{p as M,C as u};

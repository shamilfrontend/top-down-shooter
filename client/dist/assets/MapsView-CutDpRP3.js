import{M as z,u as B}from"./MapRenderer-7N1qoh_1.js";import{d as k,n as E,p as C,q as L,c as r,m as h,o,_ as R,a as _,t as M,F,l as V,b as I,s as P,e as b,y as q}from"./index-BjcpxiQA.js";const A=k({__name:"MapPreview",props:{map:{}},setup(y){const c=y,u=h(null);let t=null,s=null,n=null;function l(){const e=u.value,a=c.map;if(!e||!a)return;const i=e.getContext("2d");if(!i)return;const d=()=>{const m=window.devicePixelRatio||1,v=e.getBoundingClientRect();e.width=v.width*m,e.height=v.height*m,i.scale(m,m);const w=v.width,g=v.height;t?t.setSize(w,g):t=new z(i,a,w,g);const x=Math.min(w/a.width,g/a.height)*.9;t.setCamera(a.width/2,a.height/2,x)};n=d,d(),window.addEventListener("resize",d);const f=()=>{t==null||t.render(),s=requestAnimationFrame(f)};f()}function p(){n&&(window.removeEventListener("resize",n),n=null),s!==null&&(cancelAnimationFrame(s),s=null),t=null}return E(()=>c.map,e=>{p(),e&&l()}),C(()=>{c.map&&l()}),L(p),(e,a)=>(o(),r("canvas",{ref_key:"canvasRef",ref:u,class:"map-preview"},null,512))}}),N=R(A,[["__scopeId","data-v-68eed295"]]),S={class:"maps-view"},$={key:0,class:"loading"},D={key:1,class:"error"},H={key:2,class:"content"},U={class:"sidebar"},j=["onClick"],G={class:"preview-area"},J=k({__name:"MapsView",setup(y){const{mapsList:c,fetchMapsList:u,fetchMap:t}=B(),s=h(null),n=h(!1),l=h(null);C(async()=>{n.value=!0;try{await u(),c.value.length>0&&(s.value=await t(c.value[0].id))}catch(e){l.value=e instanceof Error?e.message:"Ошибка загрузки"}finally{n.value=!1}});async function p(e){try{s.value=await t(e)}catch(a){l.value=a instanceof Error?a.message:"Ошибка"}}return(e,a)=>(o(),r("div",S,[a[0]||(a[0]=_("header",{class:"header"},[_("h1",null,"Карты")],-1)),n.value?(o(),r("div",$,"Загрузка...")):l.value?(o(),r("div",D,M(l.value),1)):(o(),r("div",H,[_("aside",U,[(o(!0),r(F,null,V(I(c),i=>{var d;return o(),r("div",{key:i.id,class:q(["map-item",{active:((d=s.value)==null?void 0:d.id)===i.id}]),onClick:f=>p(i.id)},M(i.name),11,j)}),128))]),_("main",G,[s.value?(o(),P(N,{key:0,map:s.value},null,8,["map"])):b("",!0)])]))]))}}),Q=R(J,[["__scopeId","data-v-c96a0ea0"]]);export{Q as default};

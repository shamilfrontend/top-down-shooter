import{M as z,u as V}from"./MapRenderer-xkhg8OLD.js";import{d as M,q as B,s as x,x as E,c,p as h,o as i,_ as C,a as v,f as L,w as F,t as y,F as N,l as b,b as I,y as P,e as q,r as A,h as S,n as $}from"./index-Dje41XHH.js";const D=M({__name:"MapPreview",props:{map:{}},setup(k){const l=k,m=h(null);let a=null,s=null,n=null;function r(){const t=m.value,e=l.map;if(!t||!e)return;const d=t.getContext("2d");if(!d)return;const o=()=>{const p=window.devicePixelRatio||1,f=t.getBoundingClientRect();t.width=f.width*p,t.height=f.height*p,d.scale(p,p);const w=f.width,g=f.height;a?a.setSize(w,g):a=new z(d,e,w,g);const R=Math.min(w/e.width,g/e.height)*.9;a.setCamera(e.width/2,e.height/2,R)};n=o,o(),window.addEventListener("resize",o);const u=()=>{a==null||a.render(),s=requestAnimationFrame(u)};u()}function _(){n&&(window.removeEventListener("resize",n),n=null),s!==null&&(cancelAnimationFrame(s),s=null),a=null}return B(()=>l.map,t=>{_(),t&&r()}),x(()=>{l.map&&r()}),E(_),(t,e)=>(i(),c("canvas",{ref_key:"canvasRef",ref:m,class:"map-preview"},null,512))}}),H=C(D,[["__scopeId","data-v-68eed295"]]),T={class:"maps-view"},U={class:"header"},j={key:0,class:"loading"},G={key:1,class:"error"},J={key:2,class:"content"},K={class:"sidebar panel-cs"},O=["onClick"],Q={class:"preview-area"},W=M({__name:"MapsView",setup(k){const{mapsList:l,fetchMapsList:m,fetchMap:a}=V(),s=h(null),n=h(!1),r=h(null);x(async()=>{n.value=!0;try{await m(),l.value.length>0&&(s.value=await a(l.value[0].id))}catch(t){r.value=t instanceof Error?t.message:"Ошибка загрузки"}finally{n.value=!1}});async function _(t){try{s.value=await a(t)}catch(e){r.value=e instanceof Error?e.message:"Ошибка"}}return(t,e)=>{const d=A("router-link");return i(),c("div",T,[v("header",U,[e[1]||(e[1]=v("div",{class:"header-orange"},null,-1)),e[2]||(e[2]=v("h1",{class:"title"},"КАРТЫ",-1)),L(d,{to:"/",class:"btn-cs"},{default:F(()=>[...e[0]||(e[0]=[S("← Назад",-1)])]),_:1})]),n.value?(i(),c("div",j,"Загрузка...")):r.value?(i(),c("div",G,y(r.value),1)):(i(),c("div",J,[v("aside",K,[(i(!0),c(N,null,b(I(l),o=>{var u;return i(),c("div",{key:o.id,class:$(["map-item",{active:((u=s.value)==null?void 0:u.id)===o.id}]),onClick:p=>_(o.id)},y(o.name),11,O)}),128))]),v("main",Q,[s.value?(i(),P(H,{key:0,map:s.value},null,8,["map"])):q("",!0)])]))])}}}),Z=C(W,[["__scopeId","data-v-7a3059a5"]]);export{Z as default};

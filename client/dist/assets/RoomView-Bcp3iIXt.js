import{d as q,s as z,x as A,q as D,c as t,a as n,t as b,b as r,e as i,F as v,l as L,g as E,z as m,o as s,p as T,_ as U}from"./index-AYzDde7z.js";import{u as J,a as K}from"./room-BtTLukKK.js";const O={class:"room-view"},Q={class:"header"},W={class:"title"},X={class:"header-actions"},Y={class:"map-badge"},Z={key:0,class:"error-banner"},x={class:"room-content"},ee={key:0,class:"pending-hint"},te={key:1,class:"pending-list"},se={class:"teams"},oe={class:"team team-ct"},ne={class:"player-name"},ae={key:0,class:"badge"},le={key:1,class:"badge ready"},ce={class:"player-name bot-name"},ue=["onClick"],re=["onClick"],ie=["onClick"],de={key:0,class:"add-bot-levels"},ye=["onClick"],be=["onClick"],ve=["onClick"],me={class:"team team-t"},pe={class:"player-name"},_e={key:0,class:"badge"},ke={key:1,class:"badge ready"},he={class:"player-name bot-name"},fe=["onClick"],Ce=["onClick"],Re=["onClick"],ge={key:0,class:"add-bot-levels"},Ie=["onClick"],$e=["onClick"],Se=["onClick"],Be={class:"controls"},we=["disabled"],Ve=q({__name:"RoomView",setup(Le){const R=E(),e=J(),{connect:F,socket:I}=K(),h=m(()=>{const a=I.value,o=e.currentRoom;return!a||!o?!1:o.hostId===a.id}),$=m(()=>{var a;return((a=e.currentRoom)==null?void 0:a.slots)??[]}),S=m(()=>{var a;return((a=e.currentRoom)==null?void 0:a.pending)??[]}),y=m(()=>Math.floor($.value.length/2)),G=m(()=>$.value.slice(0,y.value)),H=m(()=>$.value.slice(y.value)),g=m(()=>S.value.some(a=>{var o;return a.socketId===((o=I.value)==null?void 0:o.id)})),B=m(()=>{var a,o;return((o=(a=e.currentRoom)==null?void 0:a.slots)==null?void 0:o.findIndex(u=>{var p,_;return((p=u.player)==null?void 0:p.socketId)===((_=I.value)==null?void 0:_.id)}))??-1}),M=m(()=>B.value>=0),w=m(()=>{var o,u,p,_;const a=B.value;return a<0?!1:((_=(p=(u=(o=e.currentRoom)==null?void 0:o.slots)==null?void 0:u[a])==null?void 0:p.player)==null?void 0:_.isReady)??!1}),k=T(null),V={easy:"Лёгкая",medium:"Средняя",hard:"Сложная"};z(()=>{if(!e.currentRoom){R.push({name:"lobby"});return}F();const a=e.setupListeners();A(a)}),D(()=>e.currentRoom,a=>{a?a.status==="playing"&&R.push({name:"networked-game",params:{roomId:a.id}}):R.push({name:"lobby"})});function N(){e.leaveRoom(),R.push({name:"lobby"})}function P(){e.setReady(!w.value)}function j(){return!h.value||!e.currentRoom||e.currentRoom.slots.filter(u=>u.player!==null||u.bot!==null).length<2?!1:e.currentRoom.slots.every(u=>!u.player||u.player.socketId===e.currentRoom.hostId||u.player.isReady)}function f(a,o){e.addBot(a,o),k.value=null}return(a,o)=>{var u,p,_;return s(),t("div",O,[n("header",Q,[o[1]||(o[1]=n("div",{class:"header-orange"},null,-1)),n("h1",W,b((u=r(e).currentRoom)==null?void 0:u.name),1),n("div",X,[n("span",Y,b((p=r(e).currentRoom)==null?void 0:p.map)+" · "+b((_=r(e).currentRoom)==null?void 0:_.maxPlayers)+" слотов",1),n("button",{type:"button",class:"btn-cs",onClick:N},"Выйти")])]),r(e).error?(s(),t("div",Z,b(r(e).error),1)):i("",!0),n("main",x,[g.value?(s(),t("p",ee,"Выберите слот в одной из команд")):i("",!0),S.value.length&&!g.value?(s(),t("p",te," Ожидают выбора: "+b(S.value.map(c=>c.username).join(", ")),1)):i("",!0),n("div",se,[n("div",oe,[o[3]||(o[3]=n("h3",null,"Спецназ",-1)),(s(!0),t(v,null,L(G.value,(c,l)=>{var C;return s(),t("div",{key:"ct-"+l,class:"slot-row panel-cs"},[c.player?(s(),t(v,{key:0},[n("span",ne,b(c.player.username),1),c.player.socketId===((C=r(e).currentRoom)==null?void 0:C.hostId)?(s(),t("span",ae,"Хост")):c.player.isReady?(s(),t("span",le,"Готов")):i("",!0)],64)):c.bot?(s(),t(v,{key:1},[n("span",ce,"Бот ("+b(V[c.bot.difficulty])+")",1),h.value?(s(),t("button",{key:0,type:"button",class:"btn-remove-bot",title:"Удалить",onClick:d=>r(e).removeBot(l)},"×",8,ue)):i("",!0)],64)):(s(),t(v,{key:2},[o[2]||(o[2]=n("span",{class:"slot-empty"},"Пусто",-1)),g.value?(s(),t("button",{key:0,type:"button",class:"btn-cs btn-slot-take",onClick:d=>r(e).takeSlot(l)}," Выбрать ",8,re)):h.value?(s(),t(v,{key:1},[n("button",{type:"button",class:"btn-cs btn-add-bot",onClick:d=>k.value=k.value===l?null:l}," Добавить бота ",8,ie),k.value===l?(s(),t("div",de,[n("button",{type:"button",class:"btn-cs btn-level",onClick:d=>f(l,"easy")},"Лёгкая",8,ye),n("button",{type:"button",class:"btn-cs btn-level",onClick:d=>f(l,"medium")},"Средняя",8,be),n("button",{type:"button",class:"btn-cs btn-level",onClick:d=>f(l,"hard")},"Сложная",8,ve)])):i("",!0)],64)):i("",!0)],64))])}),128))]),n("div",me,[o[5]||(o[5]=n("h3",null,"Террористы",-1)),(s(!0),t(v,null,L(H.value,(c,l)=>{var C;return s(),t("div",{key:"t-"+l,class:"slot-row panel-cs"},[c.player?(s(),t(v,{key:0},[n("span",pe,b(c.player.username),1),c.player.socketId===((C=r(e).currentRoom)==null?void 0:C.hostId)?(s(),t("span",_e,"Хост")):c.player.isReady?(s(),t("span",ke,"Готов")):i("",!0)],64)):c.bot?(s(),t(v,{key:1},[n("span",he,"Бот ("+b(V[c.bot.difficulty])+")",1),h.value?(s(),t("button",{key:0,type:"button",class:"btn-remove-bot",title:"Удалить",onClick:d=>r(e).removeBot(y.value+l)},"×",8,fe)):i("",!0)],64)):(s(),t(v,{key:2},[o[4]||(o[4]=n("span",{class:"slot-empty"},"Пусто",-1)),g.value?(s(),t("button",{key:0,type:"button",class:"btn-cs btn-slot-take",onClick:d=>r(e).takeSlot(y.value+l)}," Выбрать ",8,Ce)):h.value?(s(),t(v,{key:1},[n("button",{type:"button",class:"btn-cs btn-add-bot",onClick:d=>k.value=k.value===y.value+l?null:y.value+l}," Добавить бота ",8,Re),k.value===y.value+l?(s(),t("div",ge,[n("button",{type:"button",class:"btn-cs btn-level",onClick:d=>f(y.value+l,"easy")},"Лёгкая",8,Ie),n("button",{type:"button",class:"btn-cs btn-level",onClick:d=>f(y.value+l,"medium")},"Средняя",8,$e),n("button",{type:"button",class:"btn-cs btn-level",onClick:d=>f(y.value+l,"hard")},"Сложная",8,Se)])):i("",!0)],64)):i("",!0)],64))])}),128))])]),n("div",Be,[M.value?(s(),t("button",{key:0,type:"button",class:"btn-cs",onClick:P},b(w.value?"Отменить готовность":"Готов"),1)):i("",!0),h.value?(s(),t("button",{key:1,type:"button",class:"btn-cs btn-cs-primary",disabled:!j(),onClick:o[0]||(o[0]=(...c)=>r(e).startGame&&r(e).startGame(...c))}," Начать игру ",8,we)):i("",!0)])])])}}}),He=U(Ve,[["__scopeId","data-v-96da6150"]]);export{He as default};
